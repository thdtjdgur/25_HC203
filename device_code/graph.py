#수집한 데이터로 그래프를 띄우는 파일.

import re
import matplotlib.pyplot as plt

def plot_rssi(lines):
    """
    lines: iterable of strings in format
      "Detected <MAC>: <raw_rssi>, <filtered_rssi>"
    """
    # regex로 파싱
    pattern = re.compile(r"Detected\s+(\S+):\s*([-.\d]+),\s*([-.\d]+)")
    data = {}
    for line in lines:
        m = pattern.match(line.strip())
        if not m:
            continue
        mac, raw_s, filt_s = m.groups()
        raw, filt = float(raw_s), float(filt_s)
        if mac not in data:
            data[mac] = {"raw": [], "filt": []}
        data[mac]["raw"].append(raw)
        data[mac]["filt"].append(filt)

    # MAC별로 그래프
    for mac, d in data.items():
        plt.figure()  # 새로운 Figure 생성
        plt.plot(d["raw"],  label="raw")
        plt.plot(d["filt"], label="filt")
        plt.xlabel("sample index")
        plt.ylabel("RSSI (dBm)")
        plt.title(f"Beacon {mac} RSSI over time")
        plt.legend(loc="upper right")
        plt.ylim(-100, 0)
        plt.grid(True)
    plt.show()  # 모든 Figure 출력


if __name__ == "__main__":
    # 예시 데이터
    sample_lines = [
[{"pos": [0, 0], "rssi": {"C3:00:00:44:DC:1A": -56.563038839250666, "C3:00:00:44:DC:1B": -52.42029189071363, "C3:00:00:44:DC:1C": -56.667148184794485, "C3:00:00:44:DC:1D": -55.25953403604923, "C3:00:00:44:DC:1E": -52.51325940059039, "C3:00:00:44:DC:1F": -50.574407432948256}}, {"pos": [1, 0], "rssi": {"C3:00:00:44:DC:1A": -47.71287786526475, "C3:00:00:44:DC:1B": -46.13342778144958, "C3:00:00:44:DC:1C": -52.34293169957905, "C3:00:00:44:DC:1D": -48.86754547820935, "C3:00:00:44:DC:1E": -51.72125123049864, "C3:00:00:44:DC:1F": -49.62423300205127}}, {"pos": [2, 0], "rssi": {"C3:00:00:44:DC:1A": -56.002198560969745, "C3:00:00:44:DC:1B": -54.53581933996721, "C3:00:00:44:DC:1C": -59.87631889725932, "C3:00:00:44:DC:1D": -51.315047153599814, "C3:00:00:44:DC:1E": -56.70212490578414, "C3:00:00:44:DC:1F": -54.520092779576316}}, {"pos": [3, 0], "rssi": {"C3:00:00:44:DC:1A": -60.93823399698348, "C3:00:00:44:DC:1B": -59.18435029366276, "C3:00:00:44:DC:1C": -63.70822827018054, "C3:00:00:44:DC:1D": -56.88821050639326, "C3:00:00:44:DC:1E": -60.7440368537124, "C3:00:00:44:DC:1F": -59.66957395764111}}, {"pos": [4, 0], "rssi": {"C3:00:00:44:DC:1A": -59.240559546445496, "C3:00:00:44:DC:1B": -56.600623591703936, "C3:00:00:44:DC:1C": -63.99407149496792, "C3:00:00:44:DC:1D": -54.29059209935066, "C3:00:00:44:DC:1E": -59.29036075179887, "C3:00:00:44:DC:1F": -59.82404944129305}}, {"pos": [5, 0], "rssi": {"C3:00:00:44:DC:1A": -55.842121829143146, "C3:00:00:44:DC:1B": -56.95540954882217, "C3:00:00:44:DC:1C": -64.80392829214559, "C3:00:00:44:DC:1D": -55.66617534774173, "C3:00:00:44:DC:1E": -63.1863410614698, "C3:00:00:44:DC:1F": -59.89449388371955}}, {"pos": [6, 0], "rssi": {"C3:00:00:44:DC:1A": -57.2050232361809, "C3:00:00:44:DC:1B": -57.529160837736114, "C3:00:00:44:DC:1C": -59.54582506374535, "C3:00:00:44:DC:1D": -57.989788494662626, "C3:00:00:44:DC:1E": -64.63763516522303, "C3:00:00:44:DC:1F": -58.803940188542}}, {"pos": [7, 0], "rssi": {"C3:00:00:44:DC:1A": -62.30914583442499, "C3:00:00:44:DC:1B": -57.92200709156932, "C3:00:00:44:DC:1C": -62.23305828402988, "C3:00:00:44:DC:1D": -59.38699636816442, "C3:00:00:44:DC:1E": -64.7540846227673, "C3:00:00:44:DC:1F": -60.014769151554425}}, {"pos": [0, 1], "rssi": {"C3:00:00:44:DC:1A": -62.1527881714356, "C3:00:00:44:DC:1B": -61.356152270955576, "C3:00:00:44:DC:1C": -61.741054210423776, "C3:00:00:44:DC:1D": -57.9759622794724, "C3:00:00:44:DC:1E": -60.871596699479575, "C3:00:00:44:DC:1F": -59.88772259130916}}, {"pos": [1, 1], "rssi": {"C3:00:00:44:DC:1A": -59.65640671809996, "C3:00:00:44:DC:1B": -61.02184292330296, "C3:00:00:44:DC:1C": -59.95818996428597, "C3:00:00:44:DC:1D": -57.31483607821554, "C3:00:00:44:DC:1E": -62.384754207517666, "C3:00:00:44:DC:1F": -63.169389666941754}}, {"pos": [2, 1], "rssi": {"C3:00:00:44:DC:1A": -61.99229797524698, "C3:00:00:44:DC:1B": -60.413033156316224, "C3:00:00:44:DC:1C": -59.15955189756489, "C3:00:00:44:DC:1D": -57.03553970015819, "C3:00:00:44:DC:1E": -62.88297898892877, "C3:00:00:44:DC:1F": -65.80108947552932}}, {"pos": [3, 1], "rssi": {"C3:00:00:44:DC:1A": -59.41559270093703, "C3:00:00:44:DC:1B": -59.22741083365255, "C3:00:00:44:DC:1C": -58.350725651433926, "C3:00:00:44:DC:1D": -60.851324364422226, "C3:00:00:44:DC:1E": -67.0491620093647, "C3:00:00:44:DC:1F": -65.52550329219976}}, {"pos": [4, 1], "rssi": {"C3:00:00:44:DC:1A": -58.939640495816754, "C3:00:00:44:DC:1B": -59.29048636939401, "C3:00:00:44:DC:1C": -62.731209001862204, "C3:00:00:44:DC:1D": -62.40724658645796, "C3:00:00:44:DC:1E": -68.53784130470045, "C3:00:00:44:DC:1F": -64.20328444132582}}, {"pos": [5, 1], "rssi": {"C3:00:00:44:DC:1A": -57.27063051782723, "C3:00:00:44:DC:1B": -58.997447862091825, "C3:00:00:44:DC:1C": -64.08837978922804, "C3:00:00:44:DC:1D": -63.67130377528625, "C3:00:00:44:DC:1E": -69.05377364606294, "C3:00:00:44:DC:1F": -64.06064240383796}}, {"pos": [6, 1], "rssi": {"C3:00:00:44:DC:1A": -59.83353752823831, "C3:00:00:44:DC:1B": -57.58132359972548, "C3:00:00:44:DC:1C": -63.71779794191137, "C3:00:00:44:DC:1D": -60.14231295219777, "C3:00:00:44:DC:1E": -67.78133121046619, "C3:00:00:44:DC:1F": -60.8876430464692}}, {"pos": [7, 1], "rssi": {"C3:00:00:44:DC:1A": -58.9697433825354, "C3:00:00:44:DC:1B": -55.69286800689493, "C3:00:00:44:DC:1C": -64.13636725549391, "C3:00:00:44:DC:1D": -57.88567675920845, "C3:00:00:44:DC:1E": -65.80743558263863, "C3:00:00:44:DC:1F": -58.991839159254}}, {"pos": [0, 2], "rssi": {"C3:00:00:44:DC:1A": -60.85962853981382, "C3:00:00:44:DC:1B": -59.873029572170935, "C3:00:00:44:DC:1C": -60.07621262206238, "C3:00:00:44:DC:1D": -61.49681288036643, "C3:00:00:44:DC:1E": -58.80328690713276, "C3:00:00:44:DC:1F": -65.00569589706996}}, {"pos": [1, 2], "rssi": {"C3:00:00:44:DC:1A": -62.10714413140831, "C3:00:00:44:DC:1B": -63.09717719074276, "C3:00:00:44:DC:1C": -57.51173102491938, "C3:00:00:44:DC:1D": -61.282204366851296, "C3:00:00:44:DC:1E": -55.676206493828396, "C3:00:00:44:DC:1F": -66.18372360664578}}, {"pos": [2, 2], "rssi": {"C3:00:00:44:DC:1A": -62.56694101470724, "C3:00:00:44:DC:1B": -64.05422804092069, "C3:00:00:44:DC:1C": -55.94998958856219, "C3:00:00:44:DC:1D": -66.06457102154337, "C3:00:00:44:DC:1E": -60.60514481788837, "C3:00:00:44:DC:1F": -65.08656099150566}}, {"pos": [3, 2], "rssi": {"C3:00:00:44:DC:1A": -63.06478620138579, "C3:00:00:44:DC:1B": -67.06266372987751, "C3:00:00:44:DC:1C": -55.2762475605458, "C3:00:00:44:DC:1D": -67.92411262700179, "C3:00:00:44:DC:1E": -61.85959701254707, "C3:00:00:44:DC:1F": -67.40163135398218}}, {"pos": [4, 2], "rssi": {"C3:00:00:44:DC:1A": -62.71336232898651, "C3:00:00:44:DC:1B": -66.74560771442337, "C3:00:00:44:DC:1C": -55.99497379756593, "C3:00:00:44:DC:1D": -67.6664580273526, "C3:00:00:44:DC:1E": -63.13249940326747, "C3:00:00:44:DC:1F": -64.43281000489706}}, {"pos": [5, 2], "rssi": {"C3:00:00:44:DC:1A": -61.82812918412625, "C3:00:00:44:DC:1B": -63.74749569010613, "C3:00:00:44:DC:1C": -60.81574426054033, "C3:00:00:44:DC:1D": -64.8404866801409, "C3:00:00:44:DC:1E": -62.90091747538145, "C3:00:00:44:DC:1F": -61.32780534176905}}, {"pos": [6, 2], "rssi": {"C3:00:00:44:DC:1A": -64.79933974880186, "C3:00:00:44:DC:1B": -62.75499436360053, "C3:00:00:44:DC:1C": -63.74507354047881, "C3:00:00:44:DC:1D": -65.68572724415937, "C3:00:00:44:DC:1E": -65.04864949721068, "C3:00:00:44:DC:1F": -62.64825017977055}}, {"pos": [7, 2], "rssi": {"C3:00:00:44:DC:1A": -65.25848804402953, "C3:00:00:44:DC:1B": -58.286539481454156, "C3:00:00:44:DC:1C": -64.13522167211138, "C3:00:00:44:DC:1D": -62.87385891836376, "C3:00:00:44:DC:1E": -64.82040653830174, "C3:00:00:44:DC:1F": -61.10663781281869}}, {"pos": [0, 3], "rssi": {"C3:00:00:44:DC:1A": -63.76112018301886, "C3:00:00:44:DC:1B": -64.8176023035422, "C3:00:00:44:DC:1C": -61.9511826466113, "C3:00:00:44:DC:1D": -61.68241008710021, "C3:00:00:44:DC:1E": -62.74757034620012, "C3:00:00:44:DC:1F": -62.99924932170641}}, {"pos": [1, 3], "rssi": {"C3:00:00:44:DC:1A": -62.29199194877496, "C3:00:00:44:DC:1B": -64.66053656435085, "C3:00:00:44:DC:1C": -60.824334899183285, "C3:00:00:44:DC:1D": -64.83114661378312, "C3:00:00:44:DC:1E": -62.68655464072854, "C3:00:00:44:DC:1F": -65.27129703279698}}, {"pos": [2, 3], "rssi": {"C3:00:00:44:DC:1A": -62.124948486646325, "C3:00:00:44:DC:1B": -62.036890509087435, "C3:00:00:44:DC:1C": -59.07118756355432, "C3:00:00:44:DC:1D": -64.9979515169951, "C3:00:00:44:DC:1E": -63.17226169414734, "C3:00:00:44:DC:1F": -64.15935725647546}}, {"pos": [3, 3], "rssi": {"C3:00:00:44:DC:1A": -63.12514170163185, "C3:00:00:44:DC:1B": -62.149814481155865, "C3:00:00:44:DC:1C": -61.31355766758836, "C3:00:00:44:DC:1D": -64.62999471787784, "C3:00:00:44:DC:1E": -66.53598991922222, "C3:00:00:44:DC:1F": -66.71443055117615}}, {"pos": [4, 3], "rssi": {"C3:00:00:44:DC:1A": -62.481130689405894, "C3:00:00:44:DC:1B": -61.423237740690126, "C3:00:00:44:DC:1C": -61.06344375687009, "C3:00:00:44:DC:1D": -65.28243895922284, "C3:00:00:44:DC:1E": -66.35616583049635, "C3:00:00:44:DC:1F": -64.83491470811524}}, {"pos": [5, 3], "rssi": {"C3:00:00:44:DC:1A": -62.836550759351816, "C3:00:00:44:DC:1B": -60.352779192531656, "C3:00:00:44:DC:1C": -62.24776362383869, "C3:00:00:44:DC:1D": -67.3656079019009, "C3:00:00:44:DC:1E": -66.56579523612582, "C3:00:00:44:DC:1F": -65.06193941746854}}, {"pos": [6, 3], "rssi": {"C3:00:00:44:DC:1A": -64.322044855229, "C3:00:00:44:DC:1B": -57.96284420454426, "C3:00:00:44:DC:1C": -64.38837497680724, "C3:00:00:44:DC:1D": -67.0695742056441, "C3:00:00:44:DC:1E": -65.51986189527311, "C3:00:00:44:DC:1F": -60.35838643309394}}, {"pos": [7, 3], "rssi": {"C3:00:00:44:DC:1A": -61.84053880527517, "C3:00:00:44:DC:1B": -58.088701111231664, "C3:00:00:44:DC:1C": -62.56924554538358, "C3:00:00:44:DC:1D": -63.73455168644282, "C3:00:00:44:DC:1E": -63.06357024044571, "C3:00:00:44:DC:1F": -59.4267334964213}}, {"pos": [0, 4], "rssi": {"C3:00:00:44:DC:1A": -60.49414528388189, "C3:00:00:44:DC:1B": -58.906907538253584, "C3:00:00:44:DC:1C": -61.90968317204374, "C3:00:00:44:DC:1D": -58.11844991033158, "C3:00:00:44:DC:1E": -63.81106033400624, "C3:00:00:44:DC:1F": -64.22635427369755}}, {"pos": [1, 4], "rssi": {"C3:00:00:44:DC:1A": -61.141564523396596, "C3:00:00:44:DC:1B": -62.33444915513373, "C3:00:00:44:DC:1C": -59.71757807149667, "C3:00:00:44:DC:1D": -62.83243637762722, "C3:00:00:44:DC:1E": -58.849668520381364, "C3:00:00:44:DC:1F": -63.67913521610324}}, {"pos": [2, 4], "rssi": {"C3:00:00:44:DC:1A": -64.0472798572539, "C3:00:00:44:DC:1B": -63.1418648306471, "C3:00:00:44:DC:1C": -57.35100865882793, "C3:00:00:44:DC:1D": -66.94384252246948, "C3:00:00:44:DC:1E": -59.79925274430919, "C3:00:00:44:DC:1F": -60.28792784647909}}, {"pos": [3, 4], "rssi": {"C3:00:00:44:DC:1A": -62.12537918603077, "C3:00:00:44:DC:1B": -58.97496019566491, "C3:00:00:44:DC:1C": -59.090042236179, "C3:00:00:44:DC:1D": -67.21493981139399, "C3:00:00:44:DC:1E": -62.568056202821495, "C3:00:00:44:DC:1F": -60.314046640196736}}, {"pos": [4, 4], "rssi": {"C3:00:00:44:DC:1A": -63.47434771969547, "C3:00:00:44:DC:1B": -63.67721044294875, "C3:00:00:44:DC:1C": -56.62851328878479, "C3:00:00:44:DC:1D": -67.8310050043903, "C3:00:00:44:DC:1E": -59.83578174279935, "C3:00:00:44:DC:1F": -61.04929886750184}}, {"pos": [5, 4], "rssi": {"C3:00:00:44:DC:1A": -64.62283273588292, "C3:00:00:44:DC:1B": -64.3575693186332, "C3:00:00:44:DC:1C": -56.42822120355285, "C3:00:00:44:DC:1D": -68.54512592652637, "C3:00:00:44:DC:1E": -60.649501147961395, "C3:00:00:44:DC:1F": -62.3704139701736}}, {"pos": [6, 4], "rssi": {"C3:00:00:44:DC:1A": -61.7468776747967, "C3:00:00:44:DC:1B": -66.0929973195935, "C3:00:00:44:DC:1C": -57.37223796060872, "C3:00:00:44:DC:1D": -68.7584147045413, "C3:00:00:44:DC:1E": -65.90670207835146, "C3:00:00:44:DC:1F": -64.85163134950224}}, {"pos": [7, 4], "rssi": {"C3:00:00:44:DC:1A": -60.56437571028415, "C3:00:00:44:DC:1B": -65.76564542621983, "C3:00:00:44:DC:1C": -58.59539730026454, "C3:00:00:44:DC:1D": -67.59940969802268, "C3:00:00:44:DC:1E": -64.05316981117578, "C3:00:00:44:DC:1F": -63.564549714282336}}, {"pos": [0, 5], "rssi": {"C3:00:00:44:DC:1A": -61.386768886916954, "C3:00:00:44:DC:1B": -65.84682666924044, "C3:00:00:44:DC:1C": -57.46468552823141, "C3:00:00:44:DC:1D": -61.1491588124656, "C3:00:00:44:DC:1E": -58.910644868328696, "C3:00:00:44:DC:1F": -60.41361028407468}}, {"pos": [1, 5], "rssi": {"C3:00:00:44:DC:1A": -59.834239970467, "C3:00:00:44:DC:1B": -66.06739164931896, "C3:00:00:44:DC:1C": -56.246157453257936, "C3:00:00:44:DC:1D": -67.00097414538409, "C3:00:00:44:DC:1E": -55.761044220466125, "C3:00:00:44:DC:1F": -58.69320993288382}}, {"pos": [2, 5], "rssi": {"C3:00:00:44:DC:1A": -63.47651979794798, "C3:00:00:44:DC:1B": -63.38308140071082, "C3:00:00:44:DC:1C": -57.092039712743826, "C3:00:00:44:DC:1D": -66.78177935813828, "C3:00:00:44:DC:1E": -59.10914213783576, "C3:00:00:44:DC:1F": -58.919916482936756}}, {"pos": [3, 5], "rssi": {"C3:00:00:44:DC:1A": -63.10798283121695, "C3:00:00:44:DC:1B": -58.377851413164876, "C3:00:00:44:DC:1C": -55.61857318810771, "C3:00:00:44:DC:1D": -68.11920144679388, "C3:00:00:44:DC:1E": -59.91229303070794, "C3:00:00:44:DC:1F": -58.73423749606034}}, {"pos": [4, 5], "rssi": {"C3:00:00:44:DC:1A": -63.38749874998901, "C3:00:00:44:DC:1B": -62.79773055348398, "C3:00:00:44:DC:1C": -56.73179801390015, "C3:00:00:44:DC:1D": -67.96107887531063, "C3:00:00:44:DC:1E": -61.99719872311931, "C3:00:00:44:DC:1F": -59.50179781720027}}, {"pos": [5, 5], "rssi": {"C3:00:00:44:DC:1A": -62.38153168168693, "C3:00:00:44:DC:1B": -64.44798792916242, "C3:00:00:44:DC:1C": -56.94407025161307, "C3:00:00:44:DC:1D": -68.20666993441698, "C3:00:00:44:DC:1E": -63.81249478394957, "C3:00:00:44:DC:1F": -60.66456940151083}}, {"pos": [6, 5], "rssi": {"C3:00:00:44:DC:1A": -64.84145177745208, "C3:00:00:44:DC:1B": -67.20076402712102, "C3:00:00:44:DC:1C": -58.867086489722304, "C3:00:00:44:DC:1D": -68.47527047723223, "C3:00:00:44:DC:1E": -66.19925646724545, "C3:00:00:44:DC:1F": -63.65507969855505}}, {"pos": [7, 5], "rssi": {"C3:00:00:44:DC:1A": -64.88471047616027, "C3:00:00:44:DC:1B": -63.36148990651456, "C3:00:00:44:DC:1C": -59.15341030476898, "C3:00:00:44:DC:1D": -69.71663225025559, "C3:00:00:44:DC:1E": -63.850787350331736, "C3:00:00:44:DC:1F": -63.85903849227926}}]
    ]
    plot_rssi(sample_lines)